<div class="min-h-screen p-4 md:p-6">
  <div class="max-w-4xl mx-auto space-y-6">

    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-[#6c4c05]">
        <mat-icon class="align-middle mr-2">directions_bus</mat-icon>
        Painel do Motorista
      </h1>
    </div>

    @if (errorMessage) {
      <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
        <p class="text-red-700">{{ errorMessage }}</p>
      </div>
    }

    @if (!currentTrip) {
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-[#6c4c05] mb-4">Iniciar Viagem</h2>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Selecionar Rota</label>
            <select class="w-full border border-gray-300 rounded-lg p-2 focus:ring-[#6c4c05] focus:border-[#6c4c05]"
              (change)="selectedRouteId = +$any($event.target).value">
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }}</option>
              }
            </select>
          </div>
          <button (click)="startTrip()" [disabled]="isLoading || !selectedRouteId"
            class="w-full bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition font-semibold disabled:opacity-50">
            <mat-icon class="align-middle mr-1">play_arrow</mat-icon>
            Iniciar Viagem
          </button>
        </div>
      </div>
    } @else {
      <div class="bg-green-50 border border-green-200 rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-lg font-semibold text-green-800">Viagem em Andamento</h2>
            <p class="text-sm text-green-600">Rota: {{ currentTrip.busRouteName }}</p>
            <p class="text-sm text-green-600">Início: {{ currentTrip.startedAt | date:'HH:mm' }}</p>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-green-800">{{ currentTrip.studentsBoarded }}</div>
            <div class="text-xs text-green-600">Embarcados</div>
          </div>
        </div>
        <button (click)="endTrip()" [disabled]="isLoading"
          class="w-full bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition font-semibold disabled:opacity-50">
          <mat-icon class="align-middle mr-1">stop</mat-icon>
          Encerrar Viagem
        </button>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-[#6c4c05] mb-4">
          <mat-icon class="align-middle mr-1">people</mat-icon>
          Alunos
        </h2>
        <div class="space-y-3">
          @for (student of students; track student.id) {
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <div>
                <p class="font-medium">{{ student.name }}</p>
                <p class="text-sm text-gray-500">{{ student.grade }} - {{ student.school }}</p>
              </div>
              <div class="flex gap-2">
                <button (click)="boardStudent(student.id)"
                  class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition">
                  <mat-icon class="text-sm">arrow_upward</mat-icon> Embarcar
                </button>
                <button (click)="dropStudent(student.id)"
                  class="bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600 transition">
                  <mat-icon class="text-sm">arrow_downward</mat-icon> Desembarcar
                </button>
              </div>
            </div>
          } @empty {
            <p class="text-gray-500 text-sm">Nenhum aluno na rota.</p>
          }
        </div>
      </div>
    }

    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold text-[#6c4c05] mb-4">
        <mat-icon class="align-middle mr-1">history</mat-icon>
        Histórico Recente
      </h2>
      <div class="space-y-2">
        @for (trip of tripHistory; track trip.id) {
          <div class="flex items-center justify-between p-3 border-b border-gray-100">
            <div>
              <p class="font-medium text-sm">{{ trip.busRouteName }}</p>
              <p class="text-xs text-gray-500">{{ trip.startedAt | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <div class="text-right">
              <span class="text-xs px-2 py-1 rounded-full"
                [class.bg-green-100]="trip.status === 'COMPLETED'"
                [class.text-green-700]="trip.status === 'COMPLETED'"
                [class.bg-red-100]="trip.status === 'CANCELLED'"
                [class.text-red-700]="trip.status === 'CANCELLED'">
                {{ trip.status === 'COMPLETED' ? 'Concluída' : trip.status === 'CANCELLED' ? 'Cancelada' : 'Em andamento' }}
              </span>
              <p class="text-xs text-gray-500 mt-1">{{ trip.studentsBoarded }} alunos</p>
            </div>
          </div>
        } @empty {
          <p class="text-gray-500 text-sm">Nenhuma viagem registrada.</p>
        }
      </div>
    </div>
  </div>
</div>
